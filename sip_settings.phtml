<?

/*
    Copyright (c) 2009 AG Projects
    http://ag-projects.com

    This page provides functions for management of
    SIP account settings on a remote NGNPro server

*/

require("/etc/cdrtool/global.inc");
require("/etc/cdrtool/ngnpro_engines.inc");
require('sip_settings.php');

if (strlen($_REQUEST['reseller'])) {
    page_open(
            array("sess" => "CDRTool_Session",
                  "auth" => "CDRTool_Auth",
                  "perm" => "CDRTool_Perm"));

    $account     = $_REQUEST['account'];
    $login_type  = "admin";
    $sip_engine  = $_REQUEST['sip_engine'];

    $perm->check("provisioning");


} else {
    page_open(array("sess" => "SIP_Subscriber_Session",
                    "auth" => "SIP_Subscriber_Auth")
             );
    $account	 = $SIP['account'];
    $reseller  	 = $SIP['reseller'];
    $customer  	 = $SIP['customer'];
    $sip_engine  = $SIP['engine'];
    $login_type  = "subscriber";
}

$_class='SipSettings';
$_reseller_class=$_class.$_REQUEST['reseller'];

if (class_exists($_reseller_class)) {
	$SipSettings_class=$_reseller_class;
} else {
	$SipSettings_class=$_class;
}

$login_credentials=array(
                        'login_type' => $login_type,
                        'reseller'   => $_REQUEST['reseller'],
                        'sip_engine' => $sip_engine
                        );

if ($resellerFilters[$login_credentials['reseller']]['sip_engine']) {
	$login_credentials['sip_engine']      = $resellerFilters[$login_credentials['reseller']]['sip_engine'];
} else if ($_REQUEST['sip_engine']) {
    $login_credentials['sip_engine']=$_REQUEST['sip_engine'];
} else if ($resellerFilters['default']['sip_engine']) {
	$login_credentials['sip_engine']      = $resellerFilters['default']['sip_engine'];
}

renderUI($SipSettings_class,$account,$login_credentials,$soapEngines);

page_close();
?>
